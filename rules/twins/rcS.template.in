#!/bin/nsh
# TODO: sed base_url
echo "# 
echo "# Network"
ifconfig
ifup eth0
renew eth0
ifconfig
sleep 1

#mkdir /tmp; mount -t tmpfs /tmp ; cd /tmp 
#sleep 1
#cd /tmp/
echo "# TODO: IOTJS_PATH=/mnt/sdcard"

mkdir /mnt
mount -t tmpfs /mnt/ ; cd /mnt
mkdir /mnt/sdcard
mkdir "/mnt/sdcard/iotjs_modules"
echo "# Example"
#wget ${base_url}/run.sh
#sh /tmp/run.sh

echo "# Download from base_url=${base_url}"
# CONFIG_NSH_LINELEN=80
echo "# Express Lib"
mkdir "/mnt/sdcard/iotjs_modules/iotjs-express"
cd "/mnt/sdcard/iotjs_modules/iotjs-express"
wget "${base_url}/iotjs-express/index.js"
echo "# Express Lib internals"
mkdir "/mnt/sdcard/iotjs_modules/iotjs-express/lib"
cd "/mnt/sdcard/iotjs_modules/iotjs-express/lib"
wget "${base_url}/iotjs-express/lib/express.js"
sleep 1
echo "# Express /example"
#echo "console.log(require('iotjs-express'))" > example.js
#cat example.js
#iotjs example.js


echo "# WEBTHING"
mkdir /mnt/sdcard/iotjs_modules/webthing-iotjs
cd /mnt/sdcard/iotjs_modules/webthing-iotjs
pwd

echo "# download module"
sleep 1
wget "${base_url}/webthing-iotjs/webthing.js"
sleep 1
wget "${base_url}/webthing-iotjs/index.js"
#cat webthing.js

echo "# download module internals - TODO: webpack"
mkdir "/mnt/sdcard/iotjs_modules/webthing-iotjs/lib"
cd "/mnt/sdcard/iotjs_modules/webthing-iotjs/lib"
#wget "${base_url}/express.js"
sleep 1
wget "${base_url}/webthing-iotjs/lib/property.js"
sleep 1
wget "${base_url}/webthing-iotjs/lib/server.js"
sleep 1
wget "${base_url}/webthing-iotjs/lib/thing.js"
sleep 1
wget "${base_url}/webthing-iotjs/lib/utils.js"
sleep 1
wget "${base_url}/webthing-iotjs/lib/value.js"

echo '# example: simplest thing'
mkdir /mnt/sdcard/iotjs_modules/webthing-iotjs/example
cd /mnt/sdcard/iotjs_modules/webthing-iotjs/example
wget "${base_url}/webthing-iotjs/example/simplest-thing.js"

cd /mnt/sdcard/iotjs_modules/
#iotjs webthing-iotjs/example/simplest-thing.js

cd /mnt/sdcard/
#cd /mnt/sdcard/iotjs_modules/webthing-iotjs
#cd /mnt/sdcard
# wget "${base_url}/servo-thing.js"
#iotjs servo-thing.js

echo "TODO: PWM"

cd /mnt/sdcard/
sleep 1
wget "${base_url}/pwm-property.js"
wget "${base_url}/index.js"

iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
iotjs index
